<!-- ••[1]••••••••••••••••••••••••• resume-form.component.html •••••••••••••••••••••••••••••• -->

<div class="app-resume-form">
  <form
    class="m-10 border-2 border-primary rounded-md p-6 shadow-lg shadow-primary"
    [formGroup]="resumeForm"
    (ngSubmit)="onSubmit($event, resumeForm)"
  >
    <!-- Contact -->
    <ng-container [ngTemplateOutlet]="contactFieldsetRef"></ng-container>

    <!-- Profile -->
    <ng-container [ngTemplateOutlet]="profileFieldsetRef"></ng-container>

    <!-- Capabilities -->
    <ng-container [ngTemplateOutlet]="capabilitiesFieldsetRef"></ng-container>

    <!-- Skills -->
    <ng-container [ngTemplateOutlet]="skillsFieldsetRef"></ng-container>

    <!-- Educations -->
    <ng-container [ngTemplateOutlet]="educationsFieldsetRef"></ng-container>

    <!-- Form actions -->
    <ng-container [ngTemplateOutlet]="formActionsRef"></ng-container>
  </form>
</div>

<!-- •••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••

  RENDER TEMPLATES

••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••• -->

<!-- ••[3]••••• Contact •••••••••• -->
<ng-template #contactFieldsetRef [formGroup]="resumeForm">
  <fieldset class="fieldset" formGroupName="contact">
    <legend class="legend">
      {{ contactLabel }}
    </legend>
    <!-- Name -->
    <mat-form-field class="w-full" color="primary">
      <mat-label>{{ contactNameLabel }}</mat-label>
      <input matInput type="text" formControlName="name" #contactNameRef />
      @if (contactNameRef.value) {
      <button
        matSuffix
        mat-icon-button
        matTooltip="{{ clearLabel }}"
        matTooltipPosition="above"
        (click)="contactNameRef.value = ''"
      >
        <mat-icon>close</mat-icon>
      </button>
      }
      <mat-error>
        <ng-container
          *ngTemplateOutlet="
            formErrorsRef;
            context: { $implicit: resumeForm.controls.contact.controls.name }
          "
        ></ng-container>
      </mat-error>
    </mat-form-field>
    <!-- Title -->
    <mat-form-field class="w-full" color="primary">
      <mat-label>{{ contactTitleLabel }}</mat-label>
      <input matInput type="text" formControlName="title" #contactTitleRef />
      @if (contactTitleRef.value) {
      <button
        matSuffix
        mat-icon-button
        matTooltip="{{ clearLabel }}"
        matTooltipPosition="above"
        (click)="contactTitleRef.value = ''"
      >
        <mat-icon>close</mat-icon>
      </button>
      }
      <mat-error>
        <ng-container
          *ngTemplateOutlet="
            formErrorsRef;
            context: { $implicit: resumeForm.controls.contact.controls.title }
          "
        ></ng-container>
      </mat-error>
    </mat-form-field>
  </fieldset>
</ng-template>

<!-- ••[3]••••• Profile •••••••••• -->
<ng-template #profileFieldsetRef [formGroup]="resumeForm">
  <fieldset class="fieldset mt-4" formGroupName="profile">
    <legend class="legend">
      {{ profileLabel }}
    </legend>
    <!-- Description -->
    <mat-form-field class="w-full" color="primary">
      <mat-label>{{ profileDescriptionLabel }}</mat-label>
      <input
        matInput
        type="text"
        formControlName="description"
        #profileDescriptionRef
      />
      @if (profileDescriptionRef.value) {
      <button
        matSuffix
        mat-icon-button
        matTooltip="{{ clearLabel }}"
        matTooltipPosition="above"
        (click)="profileDescriptionRef.value = ''"
      >
        <mat-icon>close</mat-icon>
      </button>
      }
      <mat-error>
        <ng-container
          *ngTemplateOutlet="
            formErrorsRef;
            context: {
              $implicit: resumeForm.controls.profile.controls.description
            }
          "
        ></ng-container>
      </mat-error>
    </mat-form-field>
  </fieldset>
</ng-template>

<!-- ••[3]••••• Capabilities •••••••••• -->
<ng-template #capabilitiesFieldsetRef [formGroup]="resumeForm">
  <fieldset class="fieldset mt-4" formArrayName="capabilities">
    <legend class="legend">
      {{ capabilitiesLabel }}
    </legend>

    <div class="flex justify-end">
      <button
        mat-mini-fab
        color="accent"
        matTooltip="{{ addCapabilityLabel }}"
        matTooltipPosition="above"
        type="button"
        (click)="addCapability()"
      >
        <mat-icon>add</mat-icon>
      </button>
    </div>

    @for (capabilityControl of resumeForm.controls.capabilities.controls; track
    capabilityControl) {

    <fieldset
      class="capability fieldset border-slate-700 mt-4"
      [formGroupName]="$index"
    >
      <legend class="font-normal capitalize px-2 text-slate-500">
        {{ capabilityLabel }} ◦ {{ $index + 1 }}
      </legend>
      <div class="flex">
        <div class="flex-1">
          <!-- Title -->
          <mat-form-field class="w-full" color="primary">
            <mat-label>{{ capabilityTitleLabel }}</mat-label>
            <input
              matInput
              type="text"
              formControlName="title"
              #capabilityTitleRef
            />
            @if (capabilityTitleRef.value) {
            <button
              matSuffix
              mat-icon-button
              matTooltip="{{ clearLabel }}"
              matTooltipPosition="above"
              (click)="capabilityTitleRef.value = ''"
            >
              <mat-icon>close</mat-icon>
            </button>
            }
            <mat-error>
              <ng-container
                *ngTemplateOutlet="
                  formErrorsRef;
                  context: {
                    $implicit:
                      resumeForm.controls.capabilities.at($index).controls.title
                  }
                "
              ></ng-container>
            </mat-error>
          </mat-form-field>
          <!-- Description -->
          <mat-form-field class="w-full" color="primary">
            <mat-label>{{ capabilityDescriptionLabel }}</mat-label>
            <input
              matInput
              type="text"
              formControlName="description"
              #capabilityDescriptionRef
            />
            @if (capabilityDescriptionRef.value) {
            <button
              matSuffix
              mat-icon-button
              matTooltip="{{ clearLabel }}"
              matTooltipPosition="above"
              (click)="capabilityDescriptionRef.value = ''"
            >
              <mat-icon>close</mat-icon>
            </button>
            }
            <mat-error>
              <ng-container
                *ngTemplateOutlet="
                  formErrorsRef;
                  context: {
                    $implicit:
                      resumeForm.controls.capabilities.at($index).controls
                        .description
                  }
                "
              ></ng-container>
            </mat-error>
          </mat-form-field>
        </div>
        @if ($count > 1) {
        <div class="ml-4">
          <button
            mat-mini-fab
            color="primary"
            matTooltip="{{ removeCapabilityLabel }}"
            matTooltipPosition="above"
            type="button"
            (click)="removeCapability($index)"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </div>
        }
      </div>
    </fieldset>
    }
  </fieldset>
</ng-template>

<!-- ••[3]••••• Skills •••••••••• -->
<ng-template #skillsFieldsetRef [formGroup]="resumeForm">
  <fieldset class="fieldset mt-4" formArrayName="skills">
    <legend class="legend">
      {{ skillsLabel }}
    </legend>

    <div class="flex justify-end">
      <button
        mat-mini-fab
        color="accent"
        matTooltip="{{ addSkillLabel }}"
        matTooltipPosition="above"
        type="button"
        (click)="addSkill()"
      >
        <mat-icon>add</mat-icon>
      </button>
    </div>

    @for (skillControl of resumeForm.controls.skills.controls; track
    skillControl) {

    <div class="flex mt-4" [class.mt-6]="$first">
      <div class="flex-1">
        <!-- Skill -->
        <mat-form-field class="w-full" color="primary">
          <mat-label>{{ skillLabel }}</mat-label>
          <input matInput type="text" [formControlName]="$index" #skillRef />
          @if (skillRef.value) {
          <button
            matSuffix
            mat-icon-button
            matTooltip="{{ clearLabel }}"
            matTooltipPosition="above"
            (click)="skillRef.value = ''"
          >
            <mat-icon>close</mat-icon>
          </button>
          }
          <mat-error>
            <ng-container
              *ngTemplateOutlet="
                formErrorsRef;
                context: {
                  $implicit: resumeForm.controls.skills.at($index)
                }
              "
            ></ng-container>
          </mat-error>
        </mat-form-field>
      </div>
      @if ($count > 1) {
      <div class="ml-4">
        <button
          mat-mini-fab
          color="primary"
          matTooltip="{{ removeSkillLabel }}"
          matTooltipPosition="above"
          type="button"
          (click)="removeSkill($index)"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      }
    </div>

    }
  </fieldset>
</ng-template>

<!-- ••[3]••••• Educations •••••••••• -->
<ng-template #educationsFieldsetRef [formGroup]="resumeForm">
  <fieldset class="fieldset mt-4" formArrayName="educations">
    <legend class="legend">
      {{ educationsLabel }}
    </legend>

    <div class="flex justify-end">
      <button
        mat-mini-fab
        color="accent"
        matTooltip="{{ addEducationLabel }}"
        matTooltipPosition="above"
        type="button"
        (click)="addEducation()"
      >
        <mat-icon>add</mat-icon>
      </button>
    </div>

    @for (educationControl of resumeForm.controls.educations.controls; track
    educationControl) {

    <fieldset
      class="education fieldset border-slate-700 mt-4"
      [formGroupName]="$index"
    >
      <legend class="font-normal capitalize px-2 text-slate-500">
        {{ educationLabel }} ◦ {{ $index + 1 }}
      </legend>
      <div class="flex">
        <div class="flex-1">
          <!-- Institution -->
          <mat-form-field class="w-full" color="primary">
            <mat-label>{{ educationInstitutionLabel }}</mat-label>
            <input
              matInput
              type="text"
              formControlName="institution"
              #educationInstitutionRef
            />
            @if (educationInstitutionRef.value) {
            <button
              matSuffix
              mat-icon-button
              matTooltip="{{ clearLabel }}"
              matTooltipPosition="above"
              (click)="educationInstitutionRef.value = ''"
            >
              <mat-icon>close</mat-icon>
            </button>
            }
            <mat-error>
              <ng-container
                *ngTemplateOutlet="
                  formErrorsRef;
                  context: {
                    $implicit:
                      resumeForm.controls.educations.at($index).controls
                        .institution
                  }
                "
              ></ng-container>
            </mat-error>
          </mat-form-field>
          <!-- Title -->
          <mat-form-field class="w-full" color="primary">
            <mat-label>{{ educationTitleLabel }}</mat-label>
            <input
              matInput
              type="text"
              formControlName="title"
              #educationTitleRef
            />
            @if (educationTitleRef.value) {
            <button
              matSuffix
              mat-icon-button
              matTooltip="{{ clearLabel }}"
              matTooltipPosition="above"
              (click)="educationTitleRef.value = ''"
            >
              <mat-icon>close</mat-icon>
            </button>
            }
            <mat-error>
              <ng-container
                *ngTemplateOutlet="
                  formErrorsRef;
                  context: {
                    $implicit:
                      resumeForm.controls.educations.at($index).controls.title
                  }
                "
              ></ng-container>
            </mat-error>
          </mat-form-field>
        </div>
        @if ($count > 1) {
        <div class="ml-4">
          <button
            mat-mini-fab
            color="primary"
            matTooltip="{{ removeEducationLabel }}"
            matTooltipPosition="above"
            type="button"
            (click)="removeEducation($index)"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </div>
        }
      </div>
    </fieldset>
    }
  </fieldset>
</ng-template>

<!-- ••[3]••••• Form actions •••••••••• -->
<ng-template #formActionsRef>
  <div class="mt-4 flex justify-end">
    <button
      mat-raised-button
      color="accent"
      type="submit"
      [disabled]="resumeForm.invalid"
    >
      {{ submitLabel }}
    </button>
  </div>
</ng-template>

<!-- ••[3]••••• Form errors •••••••••• -->
<ng-template #formErrorsRef let-formControl>
  @if (formControl.hasError('required')) {
  {{ requiredErrorFieldLabel }}
  } @else if (formControl.hasError('minlength')) {

  {{ minLengthErrorFieldLabel(formControl.errors) }}

  } @else if (formControl.hasError('pattern')) {
  {{ patternErrorFieldLabel }}
  }
</ng-template>
